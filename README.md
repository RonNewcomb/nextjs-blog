This is a starter template for React+Typescript+NextJS projects.

# Commands

- `npm run dev` to run the web app in developer mode, with hot-reload on each code change.
- `npm run build` to build the app, usually a production build.
- `npm run start` to run the built app.

# Folder/File Structure

Interesting folders:

- `/cypress/` holds testing code and some test results.
- `/public/` holds assets used at run-time, such as logos, images, favicon, etc.
- `/src/` is the source code for the app: React+Typescript.
  - `/src/components/` has the majority of source code for the app. These implement the page-level components.
  - `/src/pages/` mirrors the URL structure. For example, http://localhost:3000/posts/firstpost displays the default component in `/src/pages/posts/firstpost.tsx`
    - `/src/pages/_app.tsx` is a component which wraps the entire app. Useful to import global CSS.
    - `/src/pages/index.tsx` is the default component displayed when there is no path in the URL, as in http://localhost:3000
  - `/src/styles/` has [SASS](https://sass-lang.com/) `.scss` files. SASS is a pre-processor for CSS with variables, imports, and exports to javascript.
  - `/src/utils@buildTime/` has javascript that runs on the build server, at build time. Despite looking like these functions look like they're being called from the app from `getStaticProps()` they never appear in the browser. `getStaticProps()` is a NextJS feature.

Hidden or ignored folders:

- `/.next/` is a working folder for NextJS. `.gitignore` it.
- `/.vscode/` holds standard config for the project for the VSCode IDE. Settings include: use Prettifier, organize imports & format on save, and UNIX line endings. That's about it. Using other IDEs is fine but please ensure it calls Prettifier on saving a file.
- `/node_modules/` holds the packages downloaded from NPM. It's huge. `.gitignore` it because `package.json` explains what goes there.

Interesting files at root:

- `.env` and its friends hold variables that are passed into the app at build time, and optionally can persist into the browser. (See `.env.example` for details.) Any `.env` filename ending with `.local` is preferred over others and is also `.gitignore` so you may change `.env.local` as you wish on your local box.
- `next-env.d.ts` holds Typescript information for the functions and objects of NextJS. **DO NOT EDIT**. It is generated by NextJS and is re-generated whenever NextJS feels like it.
- `tsconfig.json` holds compiler options for Typescript. The settings here are fairly strict, replacing the need for a linter when paired with Prettier. This config is used both for app code, for build-time code, and for test code in `/cypress/` but this can change in the future if needs dictate.
- `prettierrc` is the config for Prettier, the standard solution for front-end code auto-formatting. Most IDEs support Prettier or have extensions for it.

# About NextJS

NextJS is an opinionated framework for React. React is merely a visual templating library by design which can be used by nothing more than a `<script>` tag and inlined javascript functions, no build pipeline needed.

But React without the HTML-like `jsx` syntax, without the type safety of Typescript, without the bookmarking ability of a "router", without tests, etc. produces a rather poor developer experience. NextJS has a standard setup for all of these tools and more.

The standardized folder structure -- within `src`, `public`, `.next` -- is the first noticeable thing about NextJS, followed by the commands that npm scripts would invoke. NextJS uses many common webtools under its hood but ties them together in a standard, repeatable way.

# About Cypress

Cypress is the testing framework we use. Unlike the usual buffet approach of choosing a test runner, a test framework, a code coverage tool, a snapshotter, etc. Cypress does it all. It is both opinionated and "just works".

Unlike many front-end testing solutions Cypress includes an interactive debugger / explorer with videos and screenshots of tests, easing creation of more complicated tests.

Reading the [introduction](https://docs.cypress.io/guides/core-concepts/introduction-to-cypress) and particularly [this bit about its async nature](https://docs.cypress.io/guides/core-concepts/introduction-to-cypress#Commands-Are-Asynchronous) is rather more important than with most test solutions. It is also enlightening if one hasn't spent much time thinking about the unique needs of testing on modern front-ends.

## Installation

Required Linux packages for Cypress:

`sudo apt-get install libgtk2.0-0 libgtk-3-0 libgbm-dev libnotify-dev libgconf-2-4 libnss3 libxss1 libasound2 libxtst6 xauth xvfb`

This allows you to run cypress headlessly with `npm run tests`, wherein it outputs to the terminal in which it was ran, as with most test solutions

## Optional GUI Installation for Cypress Interactive

Cypress has an interactive UI for viewing and debugging tests, complete with screenshots and video, but it's a bit involved to get running on WSL.

First, install a GUI bridge for WSL2, with [VcXsrv](https://sourceforge.net/projects/vcxsrv/). This is a Windows .exe installer that creates an Xserver that the Linux within WSL can use. Window's name for it is **XLaunch**.

You'll next need to open a hole in Windows Defender to allow WSL to talk to the XLaunch. Go to Control Panel > System and Security > Windows Defender Firewall > Advanced Settings > Inbound Rules (wow what a big list!) > New Rule.

- Rule Type: Program
- Program: Browse to C:\Program Files\VcXsrv\VcXsrv.exe
- Action: Allow the connection
- Profile: all boxes are checked
- Name: anything you want, but something you can find in the big list of inbound rules, like "Cypress" or "XLaunch for Cypress"

## Run Cypress Interactive

Launch the Windows program `XLaunch`. For the first launch, choose options:

- defaults (Multiple windows, Display number -1)
- defaults (Start no client)
- defaults + **Disable access control** (accept all connections)

The XLaunch icon will appear in the windows system tray.

If you haven't already, ensure the app is built, `npm run build`, and the webapp is currently running, `npm run start`. The latter command will own that terminal.

In another Linux terminal, run `./go-cypress.sh` to set the DISPLAY env var and set up the dbus (sudo password required), and it will issue the final `npm run tests:interactive` for you.
